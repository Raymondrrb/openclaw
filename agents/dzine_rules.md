# Dzine Visual System — Amazon Associates Product Ranking Channel

## Context

Rayviews produces YouTube product ranking videos (Top 5 format) monetized via Amazon Associates. Dzine generates variant images per product for visual variety during 8-12 minute videos.

Default: 1 thumbnail + 3 images per product (hero, usage, detail) = 16 images per video.
With hierarchy upgrade: rank #2 adds mood (+1), rank #1 adds usage2 + mood (+2) = up to 19 images.

---

## Generation Modes

### Consistent Character (CC) — for Ray
- **ALWAYS** use CC mode for any image featuring Ray (the channel host)
- Ray character is pre-configured in Dzine (Slot 1 of 60)
- CC produces 2 images per generation (pick the better one)
- Use "canvas" aspect ratio (1536x864 = 16:9) for YouTube
- 4 credits per generation (unlimited on Master plan)
- Ray profile: "young adult male, light skin, short dark hair, light stubble, charcoal gray t-shirt, realistic style"
- **CANONICAL FACE: `assets/ray_avatar/ray_reference_face.png`** — MUST be used as CC Reference in EVERY generation. Code: `RAY_REFERENCE_FACE` in `dzine_browser.py`. `generate_ray_scene()` auto-applies this.
- **Face Swap fallback**: `face_swap_ray()` for post-hoc correction (4 credits)
- **Retrain**: `retrain_ray_character()` to update Dzine character slot with canonical face

### Txt2Img — for product images
- Use for product shots, backgrounds, and thumbnails (no character needed)
- Set 16:9 aspect ratio for hero/usage/mood/thumbnail, 1:1 for detail
- 20 credits per generation (unlimited on Master plan)
- Max prompt: 1800 chars
- Default style: Nano Banana Pro (photorealistic)

### When to use which
| Image type | Mode | Reason |
|-----------|------|--------|
| Thumbnail | Txt2Img | Product showcase, no Ray |
| Ray intro/scene | CC | Must maintain character identity |
| Product hero | Txt2Img | Product-only, no character |
| Product usage | Txt2Img | Lifestyle context, no faces |
| Product detail | Txt2Img | Macro close-up |
| Product mood | Txt2Img | Atmospheric product shot |
| Background | Txt2Img | No subject needed |

---

## Aspect Ratio Rules

**YouTube = 16:9 ALWAYS** (except detail shots)

| Image type | Ratio | Resolution | Dzine setting |
|-----------|-------|-----------|---------------|
| Thumbnail | 16:9 | 2048x1152 | 16:9 button |
| Hero | 16:9 | 2048x1152 | 16:9 button |
| Usage | 16:9 | 2048x1152 | 16:9 button |
| Mood | 16:9 | 2048x1152 | 16:9 button |
| Detail | 1:1 | 2048x2048 | 1:1 button |
| CC (Ray) | 16:9 | 1536x864 | "canvas" button |

---

## Product Preservation Rules (STRICT)

1. Use the uploaded Amazon product image as strict visual reference.
2. Preserve exact geometry, shape, buttons, ports, branding, and color.
3. Do NOT modify the product design in any way.
4. Do NOT add features, accessories, or elements not present on the real product.
5. Do NOT change product colors or materials.
6. Do NOT distort or stylize the brand logo.
7. Do NOT add text, badges, or labels to the product.
8. Do NOT hallucinate packaging, cables, or extras.
9. Only change: lighting, background, camera angle, scene context.
10. When in doubt, keep it closer to the original product photo.

---

## Image Types

### Thumbnail (1 per video)
- High-contrast, dynamic gradient background, product ~70% of frame
- Space for text overlay (text added in Resolve, NOT generated by Dzine)
- Strong depth separation, cinematic lighting
- Resolution: 2048x1152 (16:9)

### Hero (1 per product)
- Cinematic dark desk surface, premium studio lighting
- 85mm shallow DOF, dramatic key light, subtle rim light
- Aspirational, high-end commercial feel
- Resolution: 2048x1152 (16:9)

### Usage (1 per product, 2 for rank #1)
- Product in real-world context appropriate to category
- Natural lighting, lifestyle photography feel
- No visible faces or identifiable people
- Resolution: 2048x1152 (16:9)

### Detail (1 per product)
- Extreme macro close-up of key texture, buttons, ports, or material
- Strong directional side light, high sharpness
- Square format for flexibility
- Resolution: 2048x2048 (1:1)

### Mood (rank #1 and #2 only)
- Atmospheric, cinematic volumetric light
- Dramatic composition, emotional product positioning
- Aspirational storytelling
- Resolution: 2048x1152 (16:9)

---

## Prompt Structure (6 Sections)

Every Dzine prompt follows this structure:

1. **Product Integrity** — "Use the uploaded product image as strict visual reference..."
2. **Scene** — environment, surface, props
3. **Lighting** — key light, fill, rim, shadows
4. **Camera** — focal length, DOF, angle
5. **Mood** — emotional tone, style reference
6. **Restrictions** — "No redesign. No fake features. No logo distortion."

For CC (Ray) prompts: describe the SCENE, not the character. Ray's appearance is maintained automatically.

---

## File Naming

```
assets/dzine/thumbnail.png
assets/dzine/products/05_hero.png
assets/dzine/products/05_usage1.png
assets/dzine/products/05_detail.png
assets/dzine/products/01_mood.png
assets/dzine/prompts/thumbnail.txt
assets/dzine/prompts/05_hero.txt
```

---

## Category Adaptation

Scene environments vary by product category:

| Category | Usage1 Scene | Usage2 Scene |
|----------|-------------|-------------|
| audio/computing | Modern desk, neon accents | Airport/gym, on-the-go |
| kitchen | Marble counter, daylight | Outdoor patio |
| fitness | Gym, matte surfaces | Park trail |
| travel | Airport lounge | Urban commute |
| office | White + wood desk | Coffee shop |
| gaming | RGB desk setup | Couch setup |
| home | Living room | Bedroom |
| outdoor | Campsite | Hiking trail |
| camera | Studio setup | Outdoor shoot |
| baby | Nursery | Park stroll |
| streaming | Streaming desk | Mobile/cafe |

Hero and detail shots are category-independent (always cinematic/macro).

---

## Quality Checklist

- File size > 1 KB (reject if smaller — indicates download failure)
- Resolution >= 1080p dimension
- Log generation time and prompt for each image
- Single retry on failure, then skip with warning
- Telegram progress notification every 5 images

---

## Reference Image Workflow

1. Download product image from `image_url` in products.json
2. Save to `assets/amazon/{rank:02d}_ref.jpg`
3. Upload as reference when generating Dzine images
4. Dzine preserves product design while changing scene/lighting
5. Skip gracefully if download fails (generate without reference)

---

## Amazon Associates Compliance

Never generate images that imply:
- Official Amazon partnership or endorsement
- Fake discount badges or price tags
- Urgency banners ("Limited time!", "Only 3 left!")
- Review scores or star ratings in the image

All visuals must support honest product presentation.

---

## Visual Consistency

Reference `channel/channel_visual_style.md` for:
- Per-category color temperature and background tone
- Lighting consistency within a single video's asset set
- Dark cinematic for tech/gaming/audio, bright minimal for kitchen/office/baby

---

## Browser Automation Notes

- Canvas URL: `https://www.dzine.ai/canvas?id=19797967`
- Viewport: MUST be 1440x900 for stable sidebar positions
- Use JS evaluate for clicks (CSS selectors are fragile)
- Close tutorial dialogs before every interaction
- Generation is ASYNC: button goes "ready" immediately, image takes 30-90s
- Monitor Results panel for progress percentage
- Result images are downloadable via their `static.dzine.ai` URLs
- See `agents/dzine_playbook.md` for detailed step-by-step workflows
- See `agents/dzine_prompt_library.md` for 30 reusable prompt templates

---

## Export Recovery Procedure

When Dzine's Download/Export button is disabled or grayed out:
1. Click the generated result image
2. Click "Image Editor" button
3. In the layer panel, click/activate the first layer
4. The Export/Download button should now be enabled
5. If still disabled: download directly from the `static.dzine.ai` URL

{
  "_doc": "Modular Dzine prompt system. Fixed blocks never change. Variable blocks swap 1 axis per day. Paste assembled prompt into 'Character action & scene'.",
  "version": 3,

  "fixed_blocks": {
    "core_identity": "Ray (use the existing Ray character identity and the verified face reference). Same exact person, same facial structure, same hairline, same beard shape, same nose and jaw proportions. Do NOT change facial structure. No alternate identity. No hairstyle changes. No beard length changes. No age changes. No beard density change. Medium close-up talking head. Head straight, no tilt, no turn, no 3/4 view. Neutral expression only. No smile. No grimace. Looking directly into the camera lens. Mouth closed, relaxed lips, clean continuous lip line for lip-sync; no teeth silhouettes; no lip shadow breaks. Clean jawline and chin contour, no shadow artifacts.",
    "camera": "Eye-level camera, centered framing, stable composition, headroom 8-10%. 85mm lens look (no wide angle), natural perspective, no facial distortion. No wide-angle distortion. No 35mm look. No fisheye. Shoulders relaxed. Hands out of frame, no hands visible, shoulders only.",
    "lighting": "Softbox key light front-left, gentle fill front-right, subtle rim light for separation. Neutral face light. No colored cast on skin. No extreme shadows under nose/lips. Skin tone unchanged. No harsh shadows under nose/lips/chin.",
    "quality": "Clean cinematic realism. Natural skin texture, consistent pores, stable features across generations, clean background bokeh. No plastic skin. No waxy face.",
    "negative": "open mouth, teeth showing, teeth shadow, teeth silhouettes, exaggerated smile, distorted lips, double chin artifacts, messy beard noise, hairstyle change, beard length change, age change, sunglasses, hat, heavy wrinkles, low-res, oversharpen, cartoon, anime, CGI, hands visible, extra fingers, text, logos, busy background, patterned clothing, blue skin tint, cyan cast on face, color spill, lip shadow breaks, mouth seam artifacts, asymmetrical lips, warped philtrum, stretched jaw, muddy skin, oversharpened pores, plastic skin, waxy face, wide-angle distortion, fisheye."
  },

  "variable_blocks": {
    "environment": {
      "A_office_a": "Modern minimalist tech office, blurred glass partitions, soft daylight, subtle bokeh, no readable text, no logos, neutral professional vibe.",
      "B_office_b": "Same office style, but background with blurred window + faint city lights bokeh, still minimal, no readable text, no logos.",
      "C_studio": "Professional studio backdrop, deep charcoal grey gradient, clean, non-distracting, subtle bokeh.",
      "D_darkdesk": "Cozy desk setup, dark wood tones, blurred shelves and warm practical light in background, deep bokeh, no readable text, no brand logos, no props in focus."
    },
    "outfit": {
      "1_black_tee": "Solid black crew-neck t-shirt, premium cotton, no logos, no patterns.",
      "2_navy_tee": "Solid dark navy crew-neck t-shirt, premium cotton, no logos, no patterns.",
      "3_grey_hoodie": "Solid dark grey hoodie, minimal, no logos, no drawstrings visible."
    },
    "accent": {
      "1_warm": "Background ambient slightly warm, face lighting remains neutral.",
      "2_cool": "Background ambient slightly cool, face lighting remains neutral.",
      "3_rim": "Very subtle rim light tint only, face lighting neutral."
    }
  },

  "assembly_order": [
    "core_identity",
    "camera",
    "lighting",
    "{environment}",
    "{outfit}",
    "{accent}",
    "quality",
    "NEGATIVE: {negative}"
  ],

  "daily_rotation": {
    "_doc": "Change max 1 axis per day. Default safe config: C_studio + 1_black_tee + 1_warm.",
    "max_axes_per_day": 1,
    "seeds_per_attempt": 3
  },

  "fallback_levels": {
    "_doc": "Escalation when generation fails QC. Each level is tried before moving to next.",
    "0_normal": "Config of the day (1 axis varied). Use seed_ladder[0].",
    "1_soft": "Same config. Use seed_ladder[1], then seed_ladder[2].",
    "2_safe": "Safe Mode preset (SAFE_STUDIO_V1). Use seed_ladder[0..2].",
    "3_library": "Use approved keyframe from library. Zero generation.",
    "4_manual": "Human intervention. Flag for operator review.",
    "max_attempts_before_library": 6
  },

  "seed_ladder": {
    "_doc": "Deterministic seed rotation. 2 tiers. Makes failures reproducible and debuggable.",
    "tier_1": ["SafeSeed-01", "SafeSeed-02", "SafeSeed-03"],
    "tier_2": ["SafeSeed-04", "SafeSeed-05", "SafeSeed-06"],
    "usage": "Level 0: tier_1[0]. Level 1: tier_1[1], tier_1[2]. Level 2 (safe mode): tier_2[0..2]. Level 3: library.",
    "telemetry": ["attempt_count", "seed_used", "fallback_level"]
  },

  "named_prompts": {
    "_doc": "Full assembled prompt strings with ID. Reference by ID in automation.",
    "SAFE_STUDIO_V1": {
      "env": "C_studio",
      "outfit": "1_black_tee",
      "accent": "1_warm",
      "file": "prompts/SAFE_STUDIO_V1.txt"
    },
    "OFFICE_V1": {
      "env": "A_office_a",
      "outfit": "1_black_tee",
      "accent": "1_warm",
      "file": "prompts/OFFICE_V1.txt"
    },
    "DARKDESK_V1": {
      "env": "D_darkdesk",
      "outfit": "1_black_tee",
      "accent": "2_cool",
      "file": "prompts/DARKDESK_V1.txt"
    }
  },

  "prompt_versioning": {
    "_doc": "Prompts are versioned as files in prompts/. Every output stores prompt_id + prompt_hash for traceability.",
    "prompts_dir": "prompts/",
    "hash_algorithm": "sha1 (first 12 chars of hex digest)",
    "telemetry_fields": ["prompt_id", "prompt_hash"],
    "registry_script": "scripts/prompt_registry.py"
  },

  "failure_categories": {
    "_doc": "Distinguish failure types for operator action and telemetry.",
    "QC_FAIL": "Output generated but failed visual QC (mouth, eyes, identity)",
    "GEN_FAIL": "Tool error, timeout, or Dzine API failure",
    "ID_FAIL": "Identity drift â€” face does not match Keyframe Zero",
    "FILE_FAIL": "Missing asset file on disk"
  },

  "drift_regression": {
    "_doc": "Weekly regression test to detect model drift.",
    "frequency": "1x per week",
    "config": {"env": "C_studio", "outfit": "1_black_tee", "accent": "1_warm"},
    "seeds": 3,
    "compare_to": "Keyframe Zero",
    "fail_threshold": "2/3 fail identity criterion",
    "on_fail": "Reduce variation axes, increase identity lock strength if available"
  },

  "prebuilt_combos": {
    "_doc": "Ready-to-use daily combos. Pick one, paste blocks in order.",
    "monday_office": {"env": "A_office_a", "outfit": "1_black_tee", "accent": "1_warm"},
    "tuesday_office": {"env": "B_office_b", "outfit": "1_black_tee", "accent": "1_warm"},
    "wednesday_studio": {"env": "C_studio", "outfit": "2_navy_tee", "accent": "2_cool"},
    "thursday_office": {"env": "A_office_a", "outfit": "2_navy_tee", "accent": "1_warm"},
    "friday_casual": {"env": "B_office_b", "outfit": "3_grey_hoodie", "accent": "3_rim"}
  },

  "lipsync_mandatory_phrases": [
    "mouth closed",
    "relaxed lips",
    "clear lip line",
    "clean chin contour",
    "same exact person",
    "same facial structure",
    "looking into camera",
    "hands out of frame"
  ],

  "style_dna_extraction_protocol": {
    "_doc": "When analyzing a reference video/image, extract these 4 outputs.",
    "outputs": [
      "style_dna: 10 bullets (lente, luz, cor, enquadramento, fundo, pele)",
      "do_dont: 10 items (what MUST NOT change)",
      "replicable_prompt: prompt that replicates this style with travas",
      "qc_rubric: what fails QC for this specific style"
    ]
  },

  "naming_convention": {
    "pattern": "Ray_{scene}_{number:02d}.png",
    "examples": ["Ray_OfficeA_01.png", "Ray_OfficeB_03.png", "Ray_Studio_07.png"]
  },

  "keyframe_batch": {
    "_doc": "One-time batch to build keyframe library. Generate 60, keep 12.",
    "generate": 60,
    "distribution": {"A_office_a": 20, "B_office_b": 20, "C_studio": 20},
    "keep": 12,
    "keep_distribution": {"office": 8, "studio": 4},
    "crops_per_keyframe": ["16:9", "9:16", "1:1"]
  }
}
